<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/koishi.png"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#5546a3"><title>开发插件 | Koishi</title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.d641dd0e.js"><link rel="modulepreload" href="/assets/thirdeye.html.d4d5fee3.js"><link rel="modulepreload" href="/assets/thirdeye.html.c6922ac0.js"><link rel="prefetch" href="/assets/index.html.0afa29c2.js"><link rel="prefetch" href="/assets/market.html.c1f60820.js"><link rel="prefetch" href="/assets/playground.html.275d79d7.js"><link rel="prefetch" href="/assets/contact.html.381ac888.js"><link rel="prefetch" href="/assets/history.html.4961785e.js"><link rel="prefetch" href="/assets/migration.html.29c69a02.js"><link rel="prefetch" href="/assets/glossary.html.4ed9de06.js"><link rel="prefetch" href="/assets/index.html.d2fc27ec.js"><link rel="prefetch" href="/assets/index.html.4b1c9f1d.js"><link rel="prefetch" href="/assets/index.html.39b99c72.js"><link rel="prefetch" href="/assets/faq.html.4094a454.js"><link rel="prefetch" href="/assets/introduction.html.0a796884.js"><link rel="prefetch" href="/assets/index.html.7d703ff1.js"><link rel="prefetch" href="/assets/docs.html.2b700811.js"><link rel="prefetch" href="/assets/structure.html.6dd46ad1.js"><link rel="prefetch" href="/assets/v4.1.html.8e61061a.js"><link rel="prefetch" href="/assets/v4.2.html.1335080e.js"><link rel="prefetch" href="/assets/v4.3.html.a4f6abdb.js"><link rel="prefetch" href="/assets/v4.4.html.63446db3.js"><link rel="prefetch" href="/assets/v4.5.html.e9f54538.js"><link rel="prefetch" href="/assets/v4.6.html.d659a462.js"><link rel="prefetch" href="/assets/v4.7.html.d5d4acc0.js"><link rel="prefetch" href="/assets/v4.8.html.47a80e5d.js"><link rel="prefetch" href="/assets/adapter.html.52f3b5bc.js"><link rel="prefetch" href="/assets/app.html.084d3d3b.js"><link rel="prefetch" href="/assets/bot.html.199ca9f8.js"><link rel="prefetch" href="/assets/command.html.f569b1a7.js"><link rel="prefetch" href="/assets/context.html.c380c308.js"><link rel="prefetch" href="/assets/events.html.61a53e6d.js"><link rel="prefetch" href="/assets/session.html.e81a742b.js"><link rel="prefetch" href="/assets/built-in.html.d2d12474.js"><link rel="prefetch" href="/assets/database.html.cb8f9f4b.js"><link rel="prefetch" href="/assets/evaluation.html.46201467.js"><link rel="prefetch" href="/assets/model.html.f49bb21c.js"><link rel="prefetch" href="/assets/query.html.a04d39ee.js"><link rel="prefetch" href="/assets/assets.html.71036deb.js"><link rel="prefetch" href="/assets/bots.html.6f48b04a.js"><link rel="prefetch" href="/assets/http.html.905b14c1.js"><link rel="prefetch" href="/assets/i18n.html.00b95222.js"><link rel="prefetch" href="/assets/lifecycle.html.83c6b913.js"><link rel="prefetch" href="/assets/logger.html.0797d44f.js"><link rel="prefetch" href="/assets/registry.html.7f7b7638.js"><link rel="prefetch" href="/assets/router.html.55d777ea.js"><link rel="prefetch" href="/assets/selector.html.3c12281d.js"><link rel="prefetch" href="/assets/logger.html.576a36f0.js"><link rel="prefetch" href="/assets/misc.html.5c67999c.js"><link rel="prefetch" href="/assets/observer.html.5d22bc0a.js"><link rel="prefetch" href="/assets/schema.html.a448ae50.js"><link rel="prefetch" href="/assets/segment.html.2de817a1.js"><link rel="prefetch" href="/assets/nestjs.html.94a646eb.js"><link rel="prefetch" href="/assets/schemastery.html.ddfe98b0.js"><link rel="prefetch" href="/assets/api.html.be534b25.js"><link rel="prefetch" href="/assets/commands.html.354fd3ef.js"><link rel="prefetch" href="/assets/community.html.56bc5c92.js"><link rel="prefetch" href="/assets/configuration.html.164b53ce.js"><link rel="prefetch" href="/assets/intro.html.c3575c7b.js"><link rel="prefetch" href="/assets/middleware.html.ab179279.js"><link rel="prefetch" href="/assets/source.html.fd8948cb.js"><link rel="prefetch" href="/assets/started.html.139cc531.js"><link rel="prefetch" href="/assets/binding.html.2e9d74c3.js"><link rel="prefetch" href="/assets/bot.html.b3df2039.js"><link rel="prefetch" href="/assets/index.html.89b44577.js"><link rel="prefetch" href="/assets/writing.html.245d7208.js"><link rel="prefetch" href="/assets/events.html.c4d48a6d.js"><link rel="prefetch" href="/assets/mixin.html.0daa1ad9.js"><link rel="prefetch" href="/assets/selector.html.402684fe.js"><link rel="prefetch" href="/assets/service.html.0e53a554.js"><link rel="prefetch" href="/assets/execution.html.0f9b9bc4.js"><link rel="prefetch" href="/assets/help.html.0dcf88c7.js"><link rel="prefetch" href="/assets/index.html.f59cd65e.js"><link rel="prefetch" href="/assets/more.html.e4e1a50b.js"><link rel="prefetch" href="/assets/data.html.a93be113.js"><link rel="prefetch" href="/assets/extension.html.ccbf25a6.js"><link rel="prefetch" href="/assets/index.html.7161e7db.js"><link rel="prefetch" href="/assets/builtin.html.562c18cd.js"><link rel="prefetch" href="/assets/index.html.f70b2437.js"><link rel="prefetch" href="/assets/model.html.67075343.js"><link rel="prefetch" href="/assets/observer.html.dafc2f22.js"><link rel="prefetch" href="/assets/writing.html.c4b49678.js"><link rel="prefetch" href="/assets/crowdin.html.0f5a17a6.js"><link rel="prefetch" href="/assets/index.html.acb96120.js"><link rel="prefetch" href="/assets/presets.html.a2761182.js"><link rel="prefetch" href="/assets/translation.html.12b2394b.js"><link rel="prefetch" href="/assets/message.html.e63cb1dc.js"><link rel="prefetch" href="/assets/module.html.1826d2c2.js"><link rel="prefetch" href="/assets/middleware.html.66555495.js"><link rel="prefetch" href="/assets/segment.html.e9c5d526.js"><link rel="prefetch" href="/assets/session.html.318f0efb.js"><link rel="prefetch" href="/assets/index.html.d0ada8fe.js"><link rel="prefetch" href="/assets/lifecycle.html.280dde70.js"><link rel="prefetch" href="/assets/publish.html.f8e8a0b0.js"><link rel="prefetch" href="/assets/schema.html.1ceab61a.js"><link rel="prefetch" href="/assets/sandbox.html.6cc5326a.js"><link rel="prefetch" href="/assets/unit-tests.html.451170b1.js"><link rel="prefetch" href="/assets/development.html.8c9b0076.js"><link rel="prefetch" href="/assets/index.html.06fbe29c.js"><link rel="prefetch" href="/assets/adapter.html.8d4fc70a.js"><link rel="prefetch" href="/assets/chat.html.8e68571c.js"><link rel="prefetch" href="/assets/dataview.html.3c5f6b91.js"><link rel="prefetch" href="/assets/index.html.625438e3.js"><link rel="prefetch" href="/assets/market.html.302df107.js"><link rel="prefetch" href="/assets/boilerplate.html.6159bdef.js"><link rel="prefetch" href="/assets/container.html.d979e840.js"><link rel="prefetch" href="/assets/desktop.html.de974a9b.js"><link rel="prefetch" href="/assets/direct.html.c1201230.js"><link rel="prefetch" href="/assets/index.html.efe43e70.js"><link rel="prefetch" href="/assets/mobile.html.3f4caea7.js"><link rel="prefetch" href="/assets/server.html.812a9fd9.js"><link rel="prefetch" href="/assets/admin.html.c50e8b06.js"><link rel="prefetch" href="/assets/bind.html.da11f637.js"><link rel="prefetch" href="/assets/callme.html.06af01f2.js"><link rel="prefetch" href="/assets/commands.html.0a406cd8.js"><link rel="prefetch" href="/assets/locales.html.4905de6d.js"><link rel="prefetch" href="/assets/rate-limit.html.1f3d8e59.js"><link rel="prefetch" href="/assets/schedule.html.df9214d2.js"><link rel="prefetch" href="/assets/sudo.html.469ade8e.js"><link rel="prefetch" href="/assets/verifier.html.d81795c4.js"><link rel="prefetch" href="/assets/discord.html.6f3f56aa.js"><link rel="prefetch" href="/assets/kook.html.58bc0bc6.js"><link rel="prefetch" href="/assets/onebot.html.eb11e575.js"><link rel="prefetch" href="/assets/qqguild.html.1e47a0d2.js"><link rel="prefetch" href="/assets/telegram.html.2b1e626a.js"><link rel="prefetch" href="/assets/events.html.7ceb3c93.js"><link rel="prefetch" href="/assets/index.html.4985a755.js"><link rel="prefetch" href="/assets/git.html.a6075add.js"><link rel="prefetch" href="/assets/local.html.9d147458.js"><link rel="prefetch" href="/assets/remote.html.68a3e669.js"><link rel="prefetch" href="/assets/s3.html.2aebd4db.js"><link rel="prefetch" href="/assets/broadcast.html.1cd22f8f.js"><link rel="prefetch" href="/assets/echo.html.b8183f61.js"><link rel="prefetch" href="/assets/feedback.html.87d4295c.js"><link rel="prefetch" href="/assets/forward.html.1ca3d7c3.js"><link rel="prefetch" href="/assets/recall.html.8cfc4dd9.js"><link rel="prefetch" href="/assets/repeater.html.fbfdd652.js"><link rel="prefetch" href="/assets/respondent.html.0f8e07e4.js"><link rel="prefetch" href="/assets/auth.html.909fc798.js"><link rel="prefetch" href="/assets/chat.html.3b49edda.js"><link rel="prefetch" href="/assets/dataview.html.cb60dd17.js"><link rel="prefetch" href="/assets/index.html.166d981e.js"><link rel="prefetch" href="/assets/insight.html.83fa51cf.js"><link rel="prefetch" href="/assets/logger.html.500b32df.js"><link rel="prefetch" href="/assets/market.html.b0b6b118.js"><link rel="prefetch" href="/assets/sandbox.html.2f43d793.js"><link rel="prefetch" href="/assets/status.html.d0c5b353.js"><link rel="prefetch" href="/assets/level.html.de1ddfe0.js"><link rel="prefetch" href="/assets/memory.html.8ee4b278.js"><link rel="prefetch" href="/assets/mongo.html.ba82050e.js"><link rel="prefetch" href="/assets/mysql.html.52b6e1bc.js"><link rel="prefetch" href="/assets/sqlite.html.f2d18a29.js"><link rel="prefetch" href="/assets/adventure.html.f502512e.js"><link rel="prefetch" href="/assets/mock.html.59468321.js"><link rel="prefetch" href="/assets/puppeteer.html.be314efe.js"><link rel="prefetch" href="/assets/404.html.98e87f94.js"><link rel="prefetch" href="/assets/index.html.d78ca781.js"><link rel="prefetch" href="/assets/market.html.d3be5b15.js"><link rel="prefetch" href="/assets/playground.html.502930a1.js"><link rel="prefetch" href="/assets/contact.html.deeb8887.js"><link rel="prefetch" href="/assets/history.html.978be815.js"><link rel="prefetch" href="/assets/migration.html.ef2a8936.js"><link rel="prefetch" href="/assets/glossary.html.dbe2c628.js"><link rel="prefetch" href="/assets/index.html.8e9f0a22.js"><link rel="prefetch" href="/assets/index.html.a256c819.js"><link rel="prefetch" href="/assets/index.html.d3e67a2d.js"><link rel="prefetch" href="/assets/faq.html.c4f6a56d.js"><link rel="prefetch" href="/assets/introduction.html.34525cb7.js"><link rel="prefetch" href="/assets/index.html.4b208025.js"><link rel="prefetch" href="/assets/docs.html.64cf2890.js"><link rel="prefetch" href="/assets/structure.html.60e92583.js"><link rel="prefetch" href="/assets/v4.1.html.596e778b.js"><link rel="prefetch" href="/assets/v4.2.html.b6a37d97.js"><link rel="prefetch" href="/assets/v4.3.html.173f27eb.js"><link rel="prefetch" href="/assets/v4.4.html.75f96e7f.js"><link rel="prefetch" href="/assets/v4.5.html.0fd56d93.js"><link rel="prefetch" href="/assets/v4.6.html.e4c6a4f0.js"><link rel="prefetch" href="/assets/v4.7.html.b6c1c6b8.js"><link rel="prefetch" href="/assets/v4.8.html.1ddb4b04.js"><link rel="prefetch" href="/assets/adapter.html.9320b58d.js"><link rel="prefetch" href="/assets/app.html.9a71518b.js"><link rel="prefetch" href="/assets/bot.html.b153a3dd.js"><link rel="prefetch" href="/assets/command.html.fdc361cc.js"><link rel="prefetch" href="/assets/context.html.9a455a3c.js"><link rel="prefetch" href="/assets/events.html.4ce9098f.js"><link rel="prefetch" href="/assets/session.html.1f9a2dcb.js"><link rel="prefetch" href="/assets/built-in.html.4bdcca54.js"><link rel="prefetch" href="/assets/database.html.cb63a399.js"><link rel="prefetch" href="/assets/evaluation.html.9d2fb3bb.js"><link rel="prefetch" href="/assets/model.html.290a2a2c.js"><link rel="prefetch" href="/assets/query.html.85fbabec.js"><link rel="prefetch" href="/assets/assets.html.f84b068e.js"><link rel="prefetch" href="/assets/bots.html.e0596394.js"><link rel="prefetch" href="/assets/http.html.6ac79562.js"><link rel="prefetch" href="/assets/i18n.html.70049ce3.js"><link rel="prefetch" href="/assets/lifecycle.html.8d02e24f.js"><link rel="prefetch" href="/assets/logger.html.70e5ee9a.js"><link rel="prefetch" href="/assets/registry.html.5d1e231a.js"><link rel="prefetch" href="/assets/router.html.1460ecb1.js"><link rel="prefetch" href="/assets/selector.html.536b8d7c.js"><link rel="prefetch" href="/assets/logger.html.ab5c7041.js"><link rel="prefetch" href="/assets/misc.html.10685052.js"><link rel="prefetch" href="/assets/observer.html.cd1f7ac5.js"><link rel="prefetch" href="/assets/schema.html.0760c2cd.js"><link rel="prefetch" href="/assets/segment.html.4d5828af.js"><link rel="prefetch" href="/assets/nestjs.html.73e3ef7f.js"><link rel="prefetch" href="/assets/schemastery.html.233de417.js"><link rel="prefetch" href="/assets/api.html.cfd2cd95.js"><link rel="prefetch" href="/assets/commands.html.6022042f.js"><link rel="prefetch" href="/assets/community.html.e66e77a4.js"><link rel="prefetch" href="/assets/configuration.html.dfe1eab0.js"><link rel="prefetch" href="/assets/intro.html.7ea13278.js"><link rel="prefetch" href="/assets/middleware.html.f53bc1e9.js"><link rel="prefetch" href="/assets/source.html.8e578794.js"><link rel="prefetch" href="/assets/started.html.bd33ce7a.js"><link rel="prefetch" href="/assets/binding.html.47115a32.js"><link rel="prefetch" href="/assets/bot.html.871fa0b0.js"><link rel="prefetch" href="/assets/index.html.33ae2f7f.js"><link rel="prefetch" href="/assets/writing.html.02361ef5.js"><link rel="prefetch" href="/assets/events.html.e18ff4f1.js"><link rel="prefetch" href="/assets/mixin.html.fc57a88c.js"><link rel="prefetch" href="/assets/selector.html.517c533d.js"><link rel="prefetch" href="/assets/service.html.e62283a4.js"><link rel="prefetch" href="/assets/execution.html.f1bd7758.js"><link rel="prefetch" href="/assets/help.html.6dbdad7f.js"><link rel="prefetch" href="/assets/index.html.4682b9c2.js"><link rel="prefetch" href="/assets/more.html.8116652a.js"><link rel="prefetch" href="/assets/data.html.6af95a05.js"><link rel="prefetch" href="/assets/extension.html.a5a47df2.js"><link rel="prefetch" href="/assets/index.html.f1146cbc.js"><link rel="prefetch" href="/assets/builtin.html.5b31d0ac.js"><link rel="prefetch" href="/assets/index.html.1afbf07c.js"><link rel="prefetch" href="/assets/model.html.35bf39fe.js"><link rel="prefetch" href="/assets/observer.html.788a4e2e.js"><link rel="prefetch" href="/assets/writing.html.6db5ce34.js"><link rel="prefetch" href="/assets/crowdin.html.3a855602.js"><link rel="prefetch" href="/assets/index.html.da408cfd.js"><link rel="prefetch" href="/assets/presets.html.c791036f.js"><link rel="prefetch" href="/assets/translation.html.89a4898a.js"><link rel="prefetch" href="/assets/message.html.614f3ba5.js"><link rel="prefetch" href="/assets/module.html.55809984.js"><link rel="prefetch" href="/assets/middleware.html.5ab3e4f3.js"><link rel="prefetch" href="/assets/segment.html.9412ea13.js"><link rel="prefetch" href="/assets/session.html.35478238.js"><link rel="prefetch" href="/assets/index.html.49760b6f.js"><link rel="prefetch" href="/assets/lifecycle.html.378f6c58.js"><link rel="prefetch" href="/assets/publish.html.53d8424a.js"><link rel="prefetch" href="/assets/schema.html.382c0759.js"><link rel="prefetch" href="/assets/sandbox.html.5f214a78.js"><link rel="prefetch" href="/assets/unit-tests.html.d8971e3a.js"><link rel="prefetch" href="/assets/development.html.25bf07f2.js"><link rel="prefetch" href="/assets/index.html.13abe252.js"><link rel="prefetch" href="/assets/adapter.html.bee50cfc.js"><link rel="prefetch" href="/assets/chat.html.15bf558a.js"><link rel="prefetch" href="/assets/dataview.html.6d6b2ce5.js"><link rel="prefetch" href="/assets/index.html.adb13e4f.js"><link rel="prefetch" href="/assets/market.html.c72a10da.js"><link rel="prefetch" href="/assets/boilerplate.html.677643eb.js"><link rel="prefetch" href="/assets/container.html.6b79c171.js"><link rel="prefetch" href="/assets/desktop.html.b6895e36.js"><link rel="prefetch" href="/assets/direct.html.96cd2eb8.js"><link rel="prefetch" href="/assets/index.html.d9904e4e.js"><link rel="prefetch" href="/assets/mobile.html.c91ab794.js"><link rel="prefetch" href="/assets/server.html.15274489.js"><link rel="prefetch" href="/assets/admin.html.219699cc.js"><link rel="prefetch" href="/assets/bind.html.da6b8db7.js"><link rel="prefetch" href="/assets/callme.html.291449da.js"><link rel="prefetch" href="/assets/commands.html.eece7de1.js"><link rel="prefetch" href="/assets/locales.html.34e6314f.js"><link rel="prefetch" href="/assets/rate-limit.html.857089a6.js"><link rel="prefetch" href="/assets/schedule.html.6810db39.js"><link rel="prefetch" href="/assets/sudo.html.db2b267b.js"><link rel="prefetch" href="/assets/verifier.html.315d4591.js"><link rel="prefetch" href="/assets/discord.html.76c662ec.js"><link rel="prefetch" href="/assets/kook.html.a49c6fd6.js"><link rel="prefetch" href="/assets/onebot.html.c22c4550.js"><link rel="prefetch" href="/assets/qqguild.html.a302996e.js"><link rel="prefetch" href="/assets/telegram.html.9e16f64a.js"><link rel="prefetch" href="/assets/events.html.8b2a5bd7.js"><link rel="prefetch" href="/assets/index.html.38d5f922.js"><link rel="prefetch" href="/assets/git.html.981a712c.js"><link rel="prefetch" href="/assets/local.html.8379ab77.js"><link rel="prefetch" href="/assets/remote.html.279017dc.js"><link rel="prefetch" href="/assets/s3.html.92c2013c.js"><link rel="prefetch" href="/assets/broadcast.html.996f23c4.js"><link rel="prefetch" href="/assets/echo.html.a6cd19fd.js"><link rel="prefetch" href="/assets/feedback.html.3a7983cd.js"><link rel="prefetch" href="/assets/forward.html.6ac361e9.js"><link rel="prefetch" href="/assets/recall.html.a43ce475.js"><link rel="prefetch" href="/assets/repeater.html.817af109.js"><link rel="prefetch" href="/assets/respondent.html.c4467d7f.js"><link rel="prefetch" href="/assets/auth.html.2f6d9dec.js"><link rel="prefetch" href="/assets/chat.html.c5925f8e.js"><link rel="prefetch" href="/assets/dataview.html.9ff8ff8a.js"><link rel="prefetch" href="/assets/index.html.deff2541.js"><link rel="prefetch" href="/assets/insight.html.4c60c71e.js"><link rel="prefetch" href="/assets/logger.html.2f9e8c00.js"><link rel="prefetch" href="/assets/market.html.3f7c8baa.js"><link rel="prefetch" href="/assets/sandbox.html.b5bc18be.js"><link rel="prefetch" href="/assets/status.html.0689f6ec.js"><link rel="prefetch" href="/assets/level.html.6583fb93.js"><link rel="prefetch" href="/assets/memory.html.a29858b8.js"><link rel="prefetch" href="/assets/mongo.html.8f4f0b92.js"><link rel="prefetch" href="/assets/mysql.html.3f2eb77a.js"><link rel="prefetch" href="/assets/sqlite.html.e36126a3.js"><link rel="prefetch" href="/assets/adventure.html.fd8b205d.js"><link rel="prefetch" href="/assets/mock.html.334e7028.js"><link rel="prefetch" href="/assets/puppeteer.html.c59957db.js"><link rel="prefetch" href="/assets/404.html.07783839.js"><link rel="prefetch" href="/assets/index.0e8935cb.js">
    <link rel="stylesheet" href="/assets/style.de5e6b12.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><a class="deprecation-banner" href="https://koishi.chat">此文档已弃用。请访问我们的最新文档：https://koishi.chat</a><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/koishi.png" alt="Koishi"><span class="site-name can-hide">Koishi</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="v4.x (c3e10f5)"><span class="title">v4.x (c3e10f5)</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="v4.x (c3e10f5)"><span class="title">v4.x (c3e10f5)</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://koishi.js.org/v3/" rel="noopener noreferrer" target="_blank" aria-label="v3.x"><!--[--><!--]--> v3.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://koishi.js.org/v1/" rel="noopener noreferrer" target="_blank" aria-label="v1.x"><!--[--><!--]--> v1.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/manual/introduction.md" class="" aria-label="入门"><!--[--><!--]--> 入门 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/guide/" class="" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/api/" class="" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="生态"><span class="title">生态</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="生态"><span class="title">生态</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/market.html" class="" aria-label="插件市场"><!--[--><!--]--> 插件市场 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/plugins/" class="" aria-label="官方插件"><!--[--><!--]--> 官方插件 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/about/contact.md" class="" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></div><!--]--></nav><!--[--><div class="navbar-icons"><a class="icon" href="/about/contact.html" target="_blank" aria-label="Discord"><svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" viewBox="0 0 640 576"><path d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z" fill="currentColor"></path></svg></a><a class="icon" href="/about/contact.html" target="_blank" aria-label="QQ"><svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" viewBox="-96 0 640 576"><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z" fill="currentColor"></path></svg></a><a class="icon" href="https://github.com/koishijs/koishi" target="_blank" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 2C6.475 2 2 6.475 2 12a9.994 9.994 0 0 0 6.838 9.488c.5.087.687-.213.687-.476c0-.237-.013-1.024-.013-1.862c-2.512.463-3.162-.612-3.362-1.175c-.113-.288-.6-1.175-1.025-1.413c-.35-.187-.85-.65-.013-.662c.788-.013 1.35.725 1.538 1.025c.9 1.512 2.338 1.087 2.912.825c.088-.65.35-1.087.638-1.337c-2.225-.25-4.55-1.113-4.55-4.938c0-1.088.387-1.987 1.025-2.688c-.1-.25-.45-1.275.1-2.65c0 0 .837-.262 2.75 1.026a9.28 9.28 0 0 1 2.5-.338c.85 0 1.7.112 2.5.337c1.912-1.3 2.75-1.024 2.75-1.024c.55 1.375.2 2.4.1 2.65c.637.7 1.025 1.587 1.025 2.687c0 3.838-2.337 4.688-4.562 4.938c.362.312.675.912.675 1.85c0 1.337-.013 2.412-.013 2.75c0 .262.188.574.688.474A10.016 10.016 0 0 0 22 12c0-5.525-4.475-10-10-10z" fill="currentColor"></path></svg></a></div><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="v4.x (c3e10f5)"><span class="title">v4.x (c3e10f5)</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="v4.x (c3e10f5)"><span class="title">v4.x (c3e10f5)</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://koishi.js.org/v3/" rel="noopener noreferrer" target="_blank" aria-label="v3.x"><!--[--><!--]--> v3.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://koishi.js.org/v1/" rel="noopener noreferrer" target="_blank" aria-label="v1.x"><!--[--><!--]--> v1.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/manual/introduction.md" class="" aria-label="入门"><!--[--><!--]--> 入门 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/guide/" class="" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/api/" class="" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="生态"><span class="title">生态</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="生态"><span class="title">生态</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/market.html" class="" aria-label="插件市场"><!--[--><!--]--> 插件市场 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/plugins/" class="" aria-label="官方插件"><!--[--><!--]--> 官方插件 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/about/contact.md" class="" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="开发插件" tabindex="-1"><a class="header-anchor" href="#开发插件" aria-hidden="true">#</a> 开发插件</h1><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>koishi-thirdeye 利用到了 TypeScript 的一些装饰器的实验性功能。请在项目的 <code>tsconfig.json</code> 中设置这些参数以保证 koishi-thirdeye 正常运行：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;compilerOptions&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">&quot;experimentalDecorators&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">&quot;emitDecoratorMetadata&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div></div><p><a href="https://github.com/koishijs/koishi-thirdeye" target="_blank" rel="noopener noreferrer">koishi-thirdeye<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 允许您使用类装饰器开发 Koishi 插件。下面是一个一目了然的例子：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  DefinePlugin,</span></span>
<span class="line"><span style="color:#F8F8F2;">  SchemaProperty,</span></span>
<span class="line"><span style="color:#F8F8F2;">  PutOption,</span></span>
<span class="line"><span style="color:#F8F8F2;">  UseCommand,</span></span>
<span class="line"><span style="color:#F8F8F2;">  OnApply,</span></span>
<span class="line"><span style="color:#F8F8F2;">  KoaContext,</span></span>
<span class="line"><span style="color:#F8F8F2;">  UseMiddleware,</span></span>
<span class="line"><span style="color:#F8F8F2;">  UseEvent,</span></span>
<span class="line"><span style="color:#F8F8F2;">  Get,</span></span>
<span class="line"><span style="color:#F8F8F2;">  PutUserName,</span></span>
<span class="line"><span style="color:#F8F8F2;">  CommandUsage,</span></span>
<span class="line"><span style="color:#F8F8F2;">  StarterPlugin,</span></span>
<span class="line"><span style="color:#F8F8F2;">} </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Context, Session, Next } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { WebSocket } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;ws&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { IncomingMessage } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;http&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ default: </span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  commandName</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) </span><span style="color:#F92672;">implements</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">LifecycleEvents</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onApply</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 该方法会在插件加载时调用，用于在上下文中注册事件等操作。</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册中间件</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseMiddleware</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">simpleMiddleware</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">session</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Session</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">next</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Next</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (session.content </span><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;pang&#39;</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;peng&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">next</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册事件监听器</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseEvent</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;message&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">onMessage</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">session</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Session</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (session.content </span><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;ping&#39;</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> session.</span><span style="color:#A6E22E;">send</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;pong&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册指令</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{commandName}}&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿裙子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;今天穿裙子了吗？&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;color&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-c &lt;color:string&gt;  裙子的颜色&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutUserName</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿的裙子的颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。}`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册 Koa 路由</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/ping&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onPing</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">koaCtx</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">KoaContext</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    koaCtx.body </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;pong&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册 WebSocket 监听器</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Ws</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/my-ws&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onWsClientConnect</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">socket</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">WebSocket</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">req</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">IncomingMessage</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    socket.</span><span style="color:#A6E22E;">write</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;Hello!&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    socket.</span><span style="color:#A6E22E;">close</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="定义插件" tabindex="-1"><a class="header-anchor" href="#定义插件" aria-hidden="true">#</a> 定义插件</h2><p>koishi-thirdeye 允许您使用 <code>@DefinePlugin()</code> 装饰器定义类插件。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { PluginSchema, RegisterSchema, SchemaProperty, DefinePlugin } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ default: </span><span style="color:#E6DB74;">&#39;bar&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  foo</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">PluginSchema</span><span style="color:#F8F8F2;">(Config)</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">constructor</span><span style="color:#F8F8F2;">(</span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;font-style:italic;">ctx</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Context</span><span style="color:#F8F8F2;">, </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;font-style:italic;">config</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Partial</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt;) {} </span><span style="color:#88846F;">// 不建议在构造函数进行任何操作</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿裙子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;今天穿裙子了吗？&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;color&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-c &lt;color:string&gt;  裙子的颜色&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutUserName</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿的裙子的颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="元数据" tabindex="-1"><a class="header-anchor" href="#元数据" aria-hidden="true">#</a> 元数据</h3><p>插件元数据使用下列装饰器来进行定义。若存在多个定义则以最上面的定义为准。</p><ul><li><code>@PluginSchema(Config)</code> 插件的描述配置模式。可以使用 Koishi 的 Schema 对象，也可使用 schemastery-gen 提供的方法编写的配置类。</li><li><code>@PluginName(name: string)</code> 插件的名称，默认为类名。</li><li><code>@UsingService(...services: string)</code> 插件的依赖，若有多个则会进行叠加。详见 <a href="#%E5%A3%B0%E6%98%8E%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB">声明依赖关系</a> 一节。</li><li><code>@Reusable()</code> 声明插件为可重用插件。</li><li><code>@Isolate(...services: string)</code> 插件的隔离服务。</li></ul><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>koishi-thirdeye 已经重新导出了 schemastery-gen 这个包。您无需重新安装或导入 schemastery-gen 包。</p></div><h3 id="插件基类" tabindex="-1"><a class="header-anchor" href="#插件基类" aria-hidden="true">#</a> 插件基类</h3><p>为了简化插件的编写，插件基类生成器 <code>StarterPlugin(Config)</code> 实现了上面的构造函数定义，并定义了一些常用属性。因此上面的代码可以简化为：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { RegisterSchema, SchemaProperty, DefinePlugin } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ default: </span><span style="color:#E6DB74;">&#39;bar&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  foo</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(Config) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿裙子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;今天穿裙子了吗？&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;color&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-c &lt;color:string&gt;  裙子的颜色&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutUserName</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿的裙子的颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>在插件内分别可以使用 <code>this.config</code> 和 <code>this.ctx</code> 访问配置和上下文对象。</p><h2 id="属性注入" tabindex="-1"><a class="header-anchor" href="#属性注入" aria-hidden="true">#</a> 属性注入</h2><p>您可以在类成员变量中，使用装饰器进行注入成员变量。</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>注入的变量在构造函数中无法访问。您只能在 <code>onApply</code> 等生命周期钩子函数中调用。</p></div><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">constructor</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">ctx</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Context</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">config</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Partial</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt;) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 建议如此使用 Context，而不是构造函数中的</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">InjectContext</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> ctx</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Context</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 建议如此使用 Config，而不是构造函数中的</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">InjectConfig</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> config</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// Logger 名称默认为插件名称</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">InjectLogger</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> logger</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Logger</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注入 Service API 中的 Assets，并声明为依赖</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Inject</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;assets&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> assets</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Assets</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 根据属性名称判别 Service API 名称</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Inject</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> database</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">DatabaseService</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="api" tabindex="-1"><a class="header-anchor" href="#api" aria-hidden="true">#</a> API</h3><ul><li><code>@InjectContext(select?: Selection)</code> 注入上下文对象。<strong>注入的上下文对象会受全局选择器影响</strong>。</li><li><code>@InjectApp()</code> 注入 Koishi 实例对象。</li><li><code>@InjectConfig()</code> 注入插件配置。</li><li><code>@InjectLogger(name: string)</code> 注入 Koishi 日志记录器。</li><li><code>@Inject(name?: string, addUsing?: boolean)</code> 在插件类某一属性注入特定上下文 Service。<code>name</code> 若为空则默认为类方法名。 <ul><li><code>addUsing</code> 若为 <code>true</code> 则会将该服务声明为本插件的依赖。</li></ul></li></ul><h2 id="钩子方法" tabindex="-1"><a class="header-anchor" href="#钩子方法" aria-hidden="true">#</a> 钩子方法</h2><p>钩子方法会在特定的时机被调用。要使用钩子方法，只需要实现 <code>LifecycleEvents</code> 接口，并定义相应的方法即可。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(Config) </span><span style="color:#F92672;">implements</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">LifecycleEvents</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 下列方法只实现需要使用的</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onApply</span><span style="color:#F8F8F2;">() {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">onConnect</span><span style="color:#F8F8F2;">() {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">onDisconnect</span><span style="color:#F8F8F2;">() {}</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="api-1" tabindex="-1"><a class="header-anchor" href="#api-1" aria-hidden="true">#</a> API</h3><ul><li><strong>onApply:</strong> 只能是同步函数，会在插件加载时运行</li><li><strong>onConnect:</strong> 可以是异步函数，会在 Koishi 启动时运行，相当于 ready 事件的回调函数</li><li><strong>onDisconnect:</strong> 可以是异步函数，会在插件被卸载时运行，相当于 dispose 事件的回调函数</li></ul><h2 id="注册事件" tabindex="-1"><a class="header-anchor" href="#注册事件" aria-hidden="true">#</a> 注册事件</h2><p>正如最开始的例子一样，我们可以使用以 <code>Use</code> 开头的装饰器进行事件和中间件的注册监听。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  DefinePlugin,</span></span>
<span class="line"><span style="color:#F8F8F2;">  SchemaProperty,</span></span>
<span class="line"><span style="color:#F8F8F2;">  PutOption,</span></span>
<span class="line"><span style="color:#F8F8F2;">  UseCommand,</span></span>
<span class="line"><span style="color:#F8F8F2;">  OnApply,</span></span>
<span class="line"><span style="color:#F8F8F2;">  KoaContext,</span></span>
<span class="line"><span style="color:#F8F8F2;">  UseMiddleware,</span></span>
<span class="line"><span style="color:#F8F8F2;">  UseEvent,</span></span>
<span class="line"><span style="color:#F8F8F2;">  Get,</span></span>
<span class="line"><span style="color:#F8F8F2;">  PutUserName,</span></span>
<span class="line"><span style="color:#F8F8F2;">  CommandUsage,</span></span>
<span class="line"><span style="color:#F8F8F2;">  DefinePlugin</span></span>
<span class="line"><span style="color:#F8F8F2;">} </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Context, Session } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { WebSocket } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;ws&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { IncomingMessage } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;http&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ default: </span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  commandName</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) </span><span style="color:#F92672;">implements</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">LifecycleEvents</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onApply</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 该方法会在插件加载时调用，用于在上下文中注册事件等操作。</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册中间件</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseMiddleware</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">simpleMiddleware</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">session</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Session</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">next</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">NextFunction</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (session.content </span><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;pang&#39;</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;peng&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">next</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册事件监听器</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseEvent</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;message&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">onMessage</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">session</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Session</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (session.content </span><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;ping&#39;</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> session.</span><span style="color:#A6E22E;">send</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;pong&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册指令</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{commandName}}&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿裙子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;今天穿裙子了吗？&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;color&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-c &lt;color:string&gt;  裙子的颜色&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutUserName</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿的裙子的颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册 Koa 路由</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/ping&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onPing</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">koaCtx</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">KoaContext</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    koaCtx.body </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;pong&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册 WebSocket 监听器</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Ws</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/my-ws&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onWsClientConnect</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">socket</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">WebSocket</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">req</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">IncomingMessage</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    socket.</span><span style="color:#A6E22E;">write</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;Hello!&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    socket.</span><span style="color:#A6E22E;">close</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>从上例中的 <code>commandName</code> 对应的指令不难发现，事件注册的装饰器是支持配置文件插值的。上例的插件会根据用户提供的配置的 <code>commandName</code> 属性创建对应的指令。事实上，这里所有的事件描述装饰器的字符串参数，以及对象参数中的字符串属性，都是支持插值的。</p><h3 id="注册装饰器" tabindex="-1"><a class="header-anchor" href="#注册装饰器" aria-hidden="true">#</a> 注册装饰器</h3><ul><li><code>@UseMiddleware(prepend?: boolean)</code> 注册中间件。等价于 <code>ctx.middleware(callback, prepend)</code>。</li><li><code>@UseEvent(name: EventName, prepend?: boolean)</code> 注册事件监听器。等价于 <code>ctx.on(name, callback, prepend)</code>。</li><li><code>@UseBeforeEvent(name: BeforeEventName, prepend?: boolean)</code> 注册事件监听器。等价于 <code>ctx.before(name, callback, prepend)</code>。</li><li><code>@UseCommand(def: string, desc?: string, config?: Command.Config)</code> 注册指令。 <ul><li>若指定 <code>config.empty</code> 则不会注册当前函数为 action，用于没有 action 的父指令。</li></ul></li><li><code>@UseInterval(ms: number)</code> 注册定时任务，等价于 <code>ctx.setInterval(callback, ms)</code>。</li><li><code>@Get(path: string)</code> <code>@Post(path: string)</code> 在 Koishi 的 Koa 路由中注册 GET/POST 路径。此外， PUT PATCH DELETE 等方法也有所支持。</li><li><code>@Ws(path: string)</code> 注册 Koishi 的 WebSocket 监听器。</li></ul><h3 id="指令描述" tabindex="-1"><a class="header-anchor" href="#指令描述" aria-hidden="true">#</a> 指令描述</h3><p>koishi-thirdeye 使用一组装饰器进行描述指令的行为。这些装饰器需要和 <code>@UseCommand()</code> 装饰器一起使用。</p><p>特别地，可以把这些装饰器定义在插件顶部，使得该类插件中所有指令均应用这一指令描述。</p><p>我们来看一个例子。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;乒乓球真好玩！&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#88846F;">// 会适用于 ping 和 pang 两个指令</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;ping&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;Ping!&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandShortcut</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;枰！&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#88846F;">// 只适用于 ping 指令</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onPing</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;pong&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;pang&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;Pang!&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandShortcut</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;乓！&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#88846F;">// 只适用于 pang 指令</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onPang</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;peng&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h4 id="api-2" tabindex="-1"><a class="header-anchor" href="#api-2" aria-hidden="true">#</a> API</h4><ul><li><code>@CommandDescription(text: string)</code> 指令描述。等价于 <code>ctx.command(def, desc)</code> 中的描述。</li><li><code>@CommandUsage(text: string)</code> 指令介绍。等价于 <code>cmd.usage(text)</code>。</li><li><code>@CommandExample(text: string)</code> 指令示例。等价于 <code>cmd.example(text)</code>。</li><li><code>@CommandAlias(def: string)</code> 指令别名。等价于 <code>cmd.alias(def)</code>。</li><li><code>@CommandShortcut(def: string, config?: Command.Shortcut)</code> 指令快捷方式。等价于 <code>cmd.shortcut(def, config)</code>。</li><li><code>@CommandBefore(callback: Command.Action, append = false)</code> 等价于 <code>cmd.before(callback, append)</code>。</li><li><code>@CommandAction(callback: Command.Action, prepend = false)</code> 等价于 <code>cmd.action(callback, append)</code>。</li><li><code>@CommandUse(callback, ...args)</code> 指令功能配置。等价于 <code>cmd.use(callback, ...args)</code>。</li><li><code>@CommandLocale(locale: string, def: any)</code> 注册该指令特定语言的 i18n 模板。等价于 <code>ctx.i18n.define(locale, &#39;commands.{指令名称}&#39;, def)</code>。</li></ul><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>装饰器的执行顺序为由下到上。<code>@CommandBefore</code> 会从上到下执行，而 <code>@CommandAction</code> 会从下到上执行。而作为类成员方法的回调函数会<strong>最后</strong>执行。</p></div><h3 id="指令参数" tabindex="-1"><a class="header-anchor" href="#指令参数" aria-hidden="true">#</a> 指令参数</h3><p>指令参数也使用一组方法参数装饰器对由 <code>@UseCommand</code> 定义的类成员方法参数进行注入。此外，部分参数装饰器可以改变指令的行为。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册指令</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿裙子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutArg</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">count</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span><span style="color:#F8F8F2;">, </span><span style="color:#88846F;">// 注入该指令的第 1 个参数，并标记该指令的第 1 个参数是 number 类型。</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;color&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-c &lt;color&gt;  裙子的颜色&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">, </span><span style="color:#88846F;">// 为该方法添加 color 选项，注入到该参数内。</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutUserName</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">, </span><span style="color:#88846F;">// 注入调用指令的用户的名称。</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿了 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">count </span><span style="color:#F92672;">||</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 条裙子，颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>您或许可以注意到，<code>color</code> 选项并没有使用 <code>&lt;color:string&gt;</code> 这种显式指定选项类型的语法进行定义。但是 koishi-thirdeye 会由 <code>onDressCommand</code> 方法参数 <code>color</code> 的类型进行推断出 <code>string</code> 类型，并写入 <code>dress</code> 指令。类似地，<code>dress</code> 命令的第一个参数 <code>[count:number]</code> 也是自动推断生成的。因此，使用 koishi-thirdeye 编写指令的时候，无需刻意手动指定类型，大部分情况下类型会被自动推断。</p><h4 id="类参数" tabindex="-1"><a class="header-anchor" href="#类参数" aria-hidden="true">#</a> 类参数</h4><p>在属性比较多或多个指令的参数存在大量重复的情况下，使用过多方法参数装饰器可能不太优雅。这种情况下您也可以使用类定义指令参数。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">WearArg</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">PutArg</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  count</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;color&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-c &lt;color&gt;  颜色&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">PutUserName</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿裙子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutObject</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">arg</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">WearArg</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">arg.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿了 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">arg.count </span><span style="color:#F92672;">||</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 条裙子，颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">arg.color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;sock&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿袜子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onSockCommand</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutObject</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">arg</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">WearArg</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">arg.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿了 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">arg.count </span><span style="color:#F92672;">||</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 条袜子，颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">arg.color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h4 id="api-3" tabindex="-1"><a class="header-anchor" href="#api-3" aria-hidden="true">#</a> API</h4><p>这些装饰器可以用于指令对应的类成员方法参数，也可以用于注入类的方法。</p><ul><li><code>@PutArgv(field?: keyof Argv)</code> 注入 <code>Argv</code> 对象，或 <code>Argv</code> 对象的指定字段。</li><li><code>@PutSession(field?: keyof Session)</code> 注入 <code>Session</code> 对象，或 <code>Session</code> 对象的指定字段。</li><li><code>@PutArg(index: number)</code> 注入指令的第 n 个参数，从 0 开始。</li><li><code>@PutArgs()</code> 注入包含指令全部参数的数组。</li><li><code>@PutOption(name: string, desc: string, config: Argv.OptionConfig = {})</code> 给指令添加选项并注入到该参数。等价于 <code>cmd.option(name, desc, config)</code>。</li><li><code>@PutUser(fields: string[])</code> 添加一部分字段用于观测，并将 User 对象注入到该参数。</li><li><code>@PutChannel(fields: string[])</code> 添加一部分字段用于观测，并将 Channel 对象注入到该参数。</li><li><code>@PutGuild(fields: string[])</code> 添加一部分字段用于观测，并将 Guild 对象注入到该参数。</li><li><code>@PutUserName(useDatabase: boolean = true)</code> 注入当前用户的用户名。 <ul><li><code>useDatabase</code> 是否尝试从数据库获取用户名。<strong>会自动把 <code>name</code> 加入用户观察者属性中</strong>。</li></ul></li><li><code>@PutNext()</code> 注入 <code>argv.next</code> 方法。</li><li><code>@PutRenderer(path: string)</code> 注入某一特定 i18n 路径的渲染器，类型为 <code>Renderer&lt;T&gt;</code>。</li><li><code>@PutCommonRenderer()</code> 注入通用渲染器，类型为 <code>CRenderer</code>。</li><li><code>@PutValue(value: string)</code> 注入固定字符串。常用于插值时调用，以及循环注册事件的标识。</li><li><code>@PutObject()</code> 注入类定义的对象。</li></ul><h3 id="子指令" tabindex="-1"><a class="header-anchor" href="#子指令" aria-hidden="true">#</a> 子指令</h3><p>koishi-thirdeye 中，子指令需要用完整的名称进行声明。</p><ul><li>对于没有回调的父指令，可以使用 <code>empty</code> 选项，使其不具有 action 字段。</li></ul><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(Config) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;ygopro&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;YGOPro 相关指令&#39;</span><span style="color:#F8F8F2;">, { empty: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">ygoproCommand</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 该指令不会有 action，因此该方法不会被调用。</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;ygopro.rank&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;YGOPro 排名&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;查询玩家的 YGOPro 排名&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">ygoproRankCommand</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-p &lt;name:string&gt;  玩家名称&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">player</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;ygopro.rooms&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;YGOPro 房间&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;查询 YGOPro 房间列表&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">ygoproRoomsCommand</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="多语言与模板渲染" tabindex="-1"><a class="header-anchor" href="#多语言与模板渲染" aria-hidden="true">#</a> 多语言与模板渲染</h2><p>koishi-thirdeye 同样也提供了多语言以及模板渲染支持，在指令的类成员方法中使用装饰器即可使用对应的文本。</p><h3 id="注入渲染器" tabindex="-1"><a class="header-anchor" href="#注入渲染器" aria-hidden="true">#</a> 注入渲染器</h3><p>与传统的 <code>session.text</code> 不同，koishi-thirdeye 的指令回调成员函数中采用渲染器注入的方式，将渲染器函数通过方法参数装饰器注入到指令回调函数参数当中进行调用。</p><h4 id="注入通用渲染器" tabindex="-1"><a class="header-anchor" href="#注入通用渲染器" aria-hidden="true">#</a> 注入通用渲染器</h4><p>您可以使用 <code>@PutCommonRenderer</code> 注入通用渲染器，适合需要渲染不确定的文本的场景。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onFooCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutCommonRenderer</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">render</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">CRenderer</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 等价于 session.text(&#39;commands.help.description&#39;)</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;commands.help.description&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h4 id="注入指定渲染器" tabindex="-1"><a class="header-anchor" href="#注入指定渲染器" aria-hidden="true">#</a> 注入指定渲染器</h4><p><code>@PutRenderer</code> 装饰器可以用来注入某一确定路径的文本的渲染器。特别地，<code>Renderer&lt;T&gt;</code> 的类型参数可以锁定该渲染器的传入参数类型，避免开发时的类型出错。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onNotifyDress</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutRenderer</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;.notifyWear&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">render</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Renderer</span><span style="color:#F8F8F2;">&lt;{ name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;"> }&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="文本定义" tabindex="-1"><a class="header-anchor" href="#文本定义" aria-hidden="true">#</a> 文本定义</h3><p>koishi-thirdeye 中，定义文本有下面几种形式：</p><h4 id="分指令完整定义" tabindex="-1"><a class="header-anchor" href="#分指令完整定义" aria-hidden="true">#</a> 分指令完整定义</h4><p>对于代码和文本分离的场景，使用 <code>@CommandLocale(locale: string, def: any)</code> 也是一个好的选择。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;description&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;穿衣服。&quot;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;options&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">&quot;name&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;穿着的名称。&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;messages&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">&quot;notifyWear&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;今天穿 {name} 了吗？&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandLocale</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;zh&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;">require</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;../locales/zh/dress&#39;</span><span style="color:#F8F8F2;">)) </span><span style="color:#88846F;">// 对应上面的 json 文件。</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandLocale</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;en&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;">require</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;../locales/en/dress&#39;</span><span style="color:#F8F8F2;">)) </span><span style="color:#88846F;">// 略，自行脑补。</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onNotifyDress</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;name&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-n &lt;name:string&gt;&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutRenderer</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;.notifyWear&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">render</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Renderer</span><span style="color:#F8F8F2;">&lt;{ name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;"> }&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">({ name })</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h4 id="完整定义" tabindex="-1"><a class="header-anchor" href="#完整定义" aria-hidden="true">#</a> 完整定义</h4><p>对于需要集中管理文本的情况，我们也可以利用 <code>@DefineLocale</code> 装饰器使用完整定义的方式。</p><p>该装饰器需要放在类的顶部，作用等价于 <code>ctx.i18n.define</code>，形式相同。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;commands.dress&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">&quot;description&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;穿衣服。&quot;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">&quot;options&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#66D9EF;font-style:italic;">&quot;name&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;穿着的名称。&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">    },</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">&quot;messages&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#66D9EF;font-style:italic;">&quot;notifyWear&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;今天穿 {name} 了吗？&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefineLocale</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;zh&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;">require</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;../locales/zh&#39;</span><span style="color:#F8F8F2;">))</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onNotifyDress</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;name&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-n &lt;name:string&gt;&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutRenderer</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;.notifyWear&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">render</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Renderer</span><span style="color:#F8F8F2;">&lt;{ name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;"> }&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">({ name })</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="嵌套插件与异步插件" tabindex="-1"><a class="header-anchor" href="#嵌套插件与异步插件" aria-hidden="true">#</a> 嵌套插件与异步插件</h2><p>我们可以使用 <code>@UsePlugin()</code> 装饰器进行注册子插件。在插件加载时方法会自动被调用。该方法需要返回插件定义，可以使用 <code>PluginDef()</code> 方法生成。</p><p>成员方法内返回的插件定义可以是同步也可以是异步的。</p><p>例如我们需要在插件内加载 <code>@koishijs/plugin-common</code> 作为子插件，我们可以用下面的方法。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> PluginCommon </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@koishijs/plugin-common&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { DefinePlugin, BasePlugin, UsePlugin, PluginDef } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(Config) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UsePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">registerPluginCommon</span><span style="color:#F8F8F2;">() { </span><span style="color:#88846F;">// 会于插件注册时立即运行，并取返回值作为插件的嵌套插件</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">PluginDef</span><span style="color:#F8F8F2;">(PluginCommon, { echo: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">getPluginCommonConfig</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> { echo: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;"> }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UsePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">registerAsyncPluginCommon</span><span style="color:#F8F8F2;">() { </span><span style="color:#88846F;">// 可以是异步插件</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> pluginCommonConfig </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.</span><span style="color:#A6E22E;">getPluginCommonConfig</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">PluginDef</span><span style="color:#F8F8F2;">(PluginCommon, pluginCommonConfig)</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="选择器" tabindex="-1"><a class="header-anchor" href="#选择器" aria-hidden="true">#</a> 选择器</h2><p>选择器装饰器可以注册在插件类顶部，也可以注册在插件方法函数。</p><p>插件类顶部定义的上下文选择器是全局的，会影响使用 <code>@Inject</code> 或 <code>@InjectContext</code> 注入的任何上下文对象，以及构造函数中传入的上下文对象。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">OnPlatform</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;onebot&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(Config) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 类内的 this.context 现在只对 OneBot 平台有效</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">OnGuild</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseEvent</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;message&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#88846F;">// 只对 OneBot 平台的群组有效</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onMessage</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">session</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Session</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="api-4" tabindex="-1"><a class="header-anchor" href="#api-4" aria-hidden="true">#</a> API</h3><ul><li><code>@OnUser(value)</code> 等价于 <code>ctx.user(value)</code>。</li><li><code>@OnSelf(value)</code> 等价于 <code>ctx.self(value)</code>。</li><li><code>@OnGuild(value)</code> 等价于 <code>ctx.guild(value)</code>。</li><li><code>@OnChannel(value)</code> 等价于 <code>ctx.channel(value)</code>。</li><li><code>@OnPlatform(value)</code> 等价于 <code>ctx.platform(value)</code>。</li><li><code>@OnPrivate(value)</code> 等价于 <code>ctx.private(value)</code>。</li><li><code>@OnSelection(value)</code> 等价于 <code>ctx.select(value)</code>。</li></ul><h2 id="插值定义" tabindex="-1"><a class="header-anchor" href="#插值定义" aria-hidden="true">#</a> 插值定义</h2><p>正如上面的 <a href="#%E6%B3%A8%E5%86%8C%E4%BA%8B%E4%BB%B6">注册事件</a> 的例子，装饰器都是支持配置项插值的，便于自定义插件的行为。而插值所使用的语法是 <a href="https://www.npmjs.com/package/mustache" target="_blank" rel="noopener noreferrer">Mustache<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 的语法，可以使用 <code></code> 来表示插值。具体的用法可以详见 <a href="https://www.npmjs.com/package/mustache" target="_blank" rel="noopener noreferrer">Mustache<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 的文档。我们看一个更复杂的例子：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Wear</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  commandName</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  size</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  dress</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Dress</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{dress.commandName}}&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutValue</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{dress.color}}&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutValue</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{dress.size}}&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">size</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`您穿的裙子是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 色的，大小是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">size</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>koishi-thirdeye 中，支持插值的装饰器有：</p><ul><li><code>@Use</code> 开头的事件注册方法装饰器</li><li><code>@Command</code> 开头的指令描述方法装饰器</li><li><code>@Put</code> 开头的指令参数装饰器</li></ul><h2 id="流程控制" tabindex="-1"><a class="header-anchor" href="#流程控制" aria-hidden="true">#</a> 流程控制</h2><p>您可以使用流程控制装饰器来控制事件注册的流程。流程控制装饰器均有两个参数，分别为插件对象本身和插值上下文对象。</p><h3 id="循环注册" tabindex="-1"><a class="header-anchor" href="#循环注册" aria-hidden="true">#</a> 循环注册</h3><p>我们可以发现，上例插件中我们注册了裙子的指令，但是如果我们要注册更多的指令怎么办呢？如果逐个手动编写，会很麻烦。因此 koishi-thirdeye 支持循环注册事件。我们使用 <code>@For</code> 装饰器就可以循环对于每个元素进行注册，而不需要每次手动编写一个指令。</p><p>使用了 <code>@For</code> 装饰器之后，对于每个元素，该元素会注入到该方法的插值上下文中进行渲染。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Wear</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  commandName</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  size</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ type: Wear })</span></span>
<span class="line"><span style="color:#F8F8F2;">  wearings</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Wear</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">For</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;">&gt;((</span><span style="color:#FD971F;font-style:italic;">o</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> o.config.wearings)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{commandName}}&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutValue</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{color}}&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutValue</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{size}}&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">size</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`您穿的裙子是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 色的，大小是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">size</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>由于流程控制装饰器无法自动推断类型，因此为了更好地使用该装饰器，您需要如同上例一般，手动指定装饰器的类型 <code>T</code> 为插件类本身。</p></div><h3 id="多层循环" tabindex="-1"><a class="header-anchor" href="#多层循环" aria-hidden="true">#</a> 多层循环</h3><p>对于多层循环的场景，我们只需要使用多个 <code>@For</code> 装饰器即可。流程控制会从上到下依次执行，且使用一次 <code>@For</code> 都会给插值上下文注入当前循环层的所有元素。要在流程控制装饰器中访问插值上下文，可以使用流程控制装饰器的第二个参数。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Wear</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  commandName</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  size</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Component</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ type: Wear })</span></span>
<span class="line"><span style="color:#F8F8F2;">  wearings</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Wear</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ type: Component })</span></span>
<span class="line"><span style="color:#F8F8F2;">  components</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Component</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">For</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;">&gt;((</span><span style="color:#FD971F;font-style:italic;">o</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> o.config.components)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">For</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;">&gt;((</span><span style="color:#FD971F;font-style:italic;">o</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">view</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> view.wearings)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{commandName}}&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutValue</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{color}}&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutValue</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{size}}&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">size</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`您穿的裙子是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 色的，大小是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">size</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="条件注册" tabindex="-1"><a class="header-anchor" href="#条件注册" aria-hidden="true">#</a> 条件注册</h3><p>使用 <code>@If</code> 装饰器可以控制事件注册的条件。若值为 <code>false</code> 则会跳过当前节点下所有注册流程。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Wear</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  commandName</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  size</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Component</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ type: Wear })</span></span>
<span class="line"><span style="color:#F8F8F2;">  wearings</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Wear</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  enable</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">boolean</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ type: Component })</span></span>
<span class="line"><span style="color:#F8F8F2;">  components</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Component</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">For</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;">&gt;((</span><span style="color:#FD971F;font-style:italic;">o</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> o.config.components)  </span><span style="color:#88846F;">// 对于每个 components 的元素</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">If</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;">&gt;((</span><span style="color:#FD971F;font-style:italic;">o</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">view</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> view.enable)     </span><span style="color:#88846F;">// 如果 enable 为 true</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">For</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;">&gt;((</span><span style="color:#FD971F;font-style:italic;">o</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">view</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> view.wearings)  </span><span style="color:#88846F;">// 对于每个 wearings 的元素</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">If</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;">&gt;((</span><span style="color:#FD971F;font-style:italic;">o</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">view</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> view.size </span><span style="color:#F92672;">&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">)   </span><span style="color:#88846F;">// 如果 size 大于 0，才会进行注册指令</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{commandName}}&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutValue</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{color}}&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutValue</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;{{size}}&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">size</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`您穿的裙子是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 色的，大小是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">size</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>看起来比较复杂，但是实际上等价于下列的代码：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">apply</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">ctx</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">config</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">for</span><span style="color:#F8F8F2;"> (</span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> component </span><span style="color:#F92672;">of</span><span style="color:#F8F8F2;"> config.components) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (component.enable) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">for</span><span style="color:#F8F8F2;"> (</span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> wearing </span><span style="color:#F92672;">of</span><span style="color:#F8F8F2;"> component.wearings) {</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (wearing.size </span><span style="color:#F92672;">&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">          ctx.</span><span style="color:#A6E22E;">command</span><span style="color:#F8F8F2;">(wearing.commandName)</span></span>
<span class="line"><span style="color:#F8F8F2;">            .</span><span style="color:#A6E22E;">action</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`您穿的裙子是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">wearing.color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 色的，大小是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">wearing.size</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">        }</span></span>
<span class="line"><span style="color:#F8F8F2;">      }</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="声明依赖关系" tabindex="-1"><a class="header-anchor" href="#声明依赖关系" aria-hidden="true">#</a> 声明依赖关系</h2><p>koishi-thirdeye 支持自动管理插件的关系依赖列表。</p><h3 id="全局依赖" tabindex="-1"><a class="header-anchor" href="#全局依赖" aria-hidden="true">#</a> 全局依赖</h3><p>声明全局依赖有下面几种方法。您也可以把下面几种方法组合使用。</p><ul><li>使用 <code>@Inject</code> 装饰器注入服务对象时，将最后一个参数赋值为 <code>true</code>。</li></ul><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(Config) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Inject</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;database&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> database</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">DatabaseService</span><span style="color:#F8F8F2;"> </span><span style="color:#88846F;">// 注入数据库服务，并声明为依赖</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">MyPlugin.using </span><span style="color:#88846F;">// [&#39;database&#39;]</span></span></code></pre><!--]--><!--]--><!--]--></div></div><ul><li>使用 <code>@UsingService()</code> 装饰器。</li></ul><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">UsingService</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;database&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;assets&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(Config) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 业务代码</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">MyPlugin.using </span><span style="color:#88846F;">// [&#39;database&#39;, &#39;assets&#39;]</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="部分依赖" tabindex="-1"><a class="header-anchor" href="#部分依赖" aria-hidden="true">#</a> 部分依赖</h3><p>您也可以使用 <code>@UsingService()</code> 装饰器对插件类中某一个方法函数单独声明依赖。这时候该方法注册的注册的中间件、事件监听器、指令等在该类方法绑定的事件只有在该依赖存在时生效。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Inject</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> database</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">DatabaseService</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 该指令仅在数据库被安装时生效</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UsingService</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;database&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;获取自己的裙子信息&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">getDresses</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutSession</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;userId&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">userId</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> dresses </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.database.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, { userId })</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> dresses.</span><span style="color:#A6E22E;">map</span><span style="color:#F8F8F2;">((</span><span style="color:#FD971F;font-style:italic;">dress</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> dress.name).</span><span style="color:#A6E22E;">join</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;</span><span style="color:#AE81FF;">\n</span><span style="color:#E6DB74;">&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="提供服务" tabindex="-1"><a class="header-anchor" href="#提供服务" aria-hidden="true">#</a> 提供服务</h2><p>和 Service 基类不同的是，koishi-thirdeye 使用 <code>@Provide</code> 进行提供服务的声明，提供依赖注入 (DI) 风格的 IoC 的开发方式。</p><p>若该提供者需要立即生效，我们需要使用 <code>immediate</code> 属性，将其标记为立即加载的提供者。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Provide, DefinePlugin, BasePlugin } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// 类型合并定义不可省略</span></span>
<span class="line"><span style="color:#F92672;">declare</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">module</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi&#39;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">interface</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Context</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    myService</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyServicePlugin</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">Provide</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;myService&#39;</span><span style="color:#F8F8F2;">, { immediate: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-service&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyServicePlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(Config) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 该类会作为 Koishi 的 Service 供其他 Koishi 插件进行引用</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p><code>@Provide</code> 装饰器中已经提供了完整的服务提供者的逻辑，因此 <code>@Provide</code> 与 Service 基类二者取其一即可。如果您在编写数据库等 Koishi 内置服务的实现，请<strong>不要</strong>使用 <code>@Provide</code> 装饰器。</p></div><h3 id="caller-装饰器" tabindex="-1"><a class="header-anchor" href="#caller-装饰器" aria-hidden="true">#</a> <code>@Caller</code> 装饰器</h3><p>与 Koishi 的 <code>Service</code> 基类的 <code>caller</code> 字段对应，我们可以使用 <code>@Caller</code> 装饰器修饰的成员变量来获取访问该插件的上下文。</p><p>下面是一个例子，确保注册 Photo 的插件卸载时，Photo 正常被删除。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Provide, DefinePlugin, BasePlugin, Caller } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">Provide</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;MyPhotoRegistry&#39;</span><span style="color:#F8F8F2;">, { immediate: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-photo-registry&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPhotoRegistry</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(Config) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> photos </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">Set</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Photo</span><span style="color:#F8F8F2;">&gt;()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Caller</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> caller</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Context</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">addPhoto</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">photo</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Photo</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 预先保存一下正在访问该方法的上下文，预防以后发生变化。</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> ctx </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.caller</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 注册来源插件上下文的卸载监听器，使得来源插件卸载时该 Photo 自动被删除。</span></span>
<span class="line"><span style="color:#F8F8F2;">    ctx.</span><span style="color:#A6E22E;">on</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dispose&#39;</span><span style="color:#F8F8F2;">, () </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.photos.</span><span style="color:#A6E22E;">delete</span><span style="color:#F8F8F2;">(photo))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.photos.</span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(photo)</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="插件模板" tabindex="-1"><a class="header-anchor" href="#插件模板" aria-hidden="true">#</a> 插件模板</h2><p>在比较具有规模的插件开发的时候，您可能会有复用一部分插件代码的需求。一个最直接的方法是使用继承类：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  foo</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Base</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(Config) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onFoo</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.config.foo</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">BarConfig</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">Config</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  bar</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">UsingSchema</span><span style="color:#F8F8F2;">(BarConfig)</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginBar</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">Base</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;bar&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onBar</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.config.bar</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">BazConfig</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">Config</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  baz</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">UsingSchema</span><span style="color:#F8F8F2;">(BazConfig)</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginBaz</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">Base</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;baz&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onBaz</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.config.baz</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>这里您很快会发现一个问题：每定义一个派生类，就需要把配置类也继承一次，并使用 <code>@UsingSchema()</code> 对插件配置进行覆盖。在这种需要开发重复插件的情况下，您可以使用插件模板。</p><h3 id="定义插件模板" tabindex="-1"><a class="header-anchor" href="#定义插件模板" aria-hidden="true">#</a> 定义插件模板</h3><p>您可以使用 <code>CreatePluginFactory(plugin, config)</code> 方法创建插件模板：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  foo</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Base</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(Config) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onFoo</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.config.foo</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> FooPlugin </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">CreatePluginFactory</span><span style="color:#F8F8F2;">(Base, Config)</span></span></code></pre><!--]--><!--]--><!--]--></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>模板插件的配置类和插件类顶部均不加 <code>@RegisterSchema</code> 或 <code>@DefinePlugin</code> 装饰器。</p></div><h3 id="使用插件模板" tabindex="-1"><a class="header-anchor" href="#使用插件模板" aria-hidden="true">#</a> 使用插件模板</h3><p>创建的插件模板是一个类生成器，只需继承生成的类即可使用模板创建插件。类生成器接受 1 个可选参数，为该派生插件类的额外配置的类。若插件没有额外的配置，该参数可以省略。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">BarConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  bar</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginBar</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">FooPlugin</span><span style="color:#F8F8F2;">(BarConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;bar&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onBar</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.config.bar</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="内置模板" tabindex="-1"><a class="header-anchor" href="#内置模板" aria-hidden="true">#</a> 内置模板</h3><p>koishi-thirdeye 也提供了一些开箱即用的插件模板，这些模板可以帮助您简单地对各个子插件进行有效的组织。事实上，上面的 <a href="#%E6%8F%92%E4%BB%B6%E5%9F%BA%E7%B1%BB"><code>StarterPlugin</code></a> 就是内置模板的一种。</p><h4 id="组合插件" tabindex="-1"><a class="header-anchor" href="#组合插件" aria-hidden="true">#</a> 组合插件</h4><p>使用组合插件可以将多个插件组合成一个插件，并将子插件的配置映射到插件配置的某一个元素中。在父插件中可以使用 <code>getInstance(name)</code> 方法获取子插件的实例。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">FooConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  fooText</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginFoo</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(FooConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onBar</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.config.text</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">BarConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  barText</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginBar</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(BarConfig) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;bar&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onBar</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.config.barText</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">MapPlugin</span><span style="color:#F8F8F2;">({ foo: FooPlugin, bar: BarPlugin }) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onApply</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">super</span><span style="color:#F8F8F2;">.</span><span style="color:#A6E22E;">onApply</span><span style="color:#F8F8F2;">() </span><span style="color:#88846F;">// 切莫忘记，否则子插件无法正常加载</span></span>
<span class="line"><span style="color:#F8F8F2;">    console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.</span><span style="color:#A6E22E;">getInstance</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;">)) </span><span style="color:#88846F;">// FooPlugin 的实例</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">ctx.</span><span style="color:#A6E22E;">plugin</span><span style="color:#F8F8F2;">(MyPlugin, {</span></span>
<span class="line"><span style="color:#F8F8F2;">  foo: { fooText: </span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;"> },</span></span>
<span class="line"><span style="color:#F8F8F2;">  bar: { barText: </span><span style="color:#E6DB74;">&#39;bar&#39;</span><span style="color:#F8F8F2;"> },</span></span>
<span class="line"><span style="color:#F8F8F2;">})</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h4 id="合并插件" tabindex="-1"><a class="header-anchor" href="#合并插件" aria-hidden="true">#</a> 合并插件</h4><p>合并插件与组合插件类似，但是配置是直接进行合并的。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">MergePlugin</span><span style="color:#F8F8F2;">({ foo: FooPlugin, bar: BarPlugin }) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onApply</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">super</span><span style="color:#F8F8F2;">.</span><span style="color:#A6E22E;">onApply</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">    console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.</span><span style="color:#A6E22E;">getInstance</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;">)) </span><span style="color:#88846F;">// FooPlugin 的实例</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">ctx.</span><span style="color:#A6E22E;">plugin</span><span style="color:#F8F8F2;">(MyPlugin, {</span></span>
<span class="line"><span style="color:#F8F8F2;">  fooText: </span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  barText: </span><span style="color:#E6DB74;">&#39;bar&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">})</span></span></code></pre><!--]--><!--]--><!--]--></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>注意组合插件和合并插件的配置定义的不同点。</p></div><h2 id="扩展数据表" tabindex="-1"><a class="header-anchor" href="#扩展数据表" aria-hidden="true">#</a> 扩展数据表</h2><p>借助 koishi-entities 这个包，您也可以很轻松地使用类和装饰器定义数据表。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>koishi-thirdeye 已经重新导出了这个包，无需再手动导入或安装 koishi-entities。</p></div><h3 id="定义数据表" tabindex="-1"><a class="header-anchor" href="#定义数据表" aria-hidden="true">#</a> 定义数据表</h3><p>数据表类以 <code>@DefineModel</code> 装饰器进行修饰，指明表的名称。同时，每个表字段以 <code>@ModelField()</code> 装饰器进行修饰。</p><p><code>@ModelField</code> 的第一个参数用于指定表的类型，用法见 <a href="/community/database/#%E6%89%A9%E5%B1%95%E5%AD%97%E6%AE%B5" class=""><code>ctx.model</code></a> 的用法。同时，您也可以使用一些其他的相关装饰器自定义表的相关行为。</p><p>在数据库查询时，结果中的对象均会被类实例化。因此您可以在类中灵活地定义方法函数，简化数据对象的操作。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefineModel</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#88846F;">// 表名称</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Dress</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">PrimaryGenerated</span><span style="color:#F8F8F2;">() </span><span style="color:#88846F;">// 自增主键</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">ModelField</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;integer(11)&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  id</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Unique</span><span style="color:#F8F8F2;">() </span><span style="color:#88846F;">// 唯一键</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">ModelField</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">getDisplayString</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">(</span><span style="color:#F92672;">${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.id</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">)`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Foreign</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;id&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#88846F;">// 外键，指向 dress.id</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">ModelField</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;integer(11)&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  parentId</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="注册数据表模型" tabindex="-1"><a class="header-anchor" href="#注册数据表模型" aria-hidden="true">#</a> 注册数据表模型</h3><p>您只需要使用 <code>@UseModel</code> 装饰器修饰插件类即可。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">UseModel</span><span style="color:#F8F8F2;">(Dress) </span><span style="color:#88846F;">// 注册 Dress 数据表模型</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注入数据库服务，并注册为依赖</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Inject</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> database</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">DatabaseService</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress &lt;id&gt;&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">getDress</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutArg</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">id</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> [dress] </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.database.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(dress, { id })</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (dress) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> dress.</span><span style="color:#A6E22E;">getDisplayString</span><span style="color:#F8F8F2;">() </span><span style="color:#88846F;">// 可以使用对象方法</span></span>
<span class="line"><span style="color:#F8F8F2;">    } </span><span style="color:#F92672;">else</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;Not found.&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="扩展内置数据表" tabindex="-1"><a class="header-anchor" href="#扩展内置数据表" aria-hidden="true">#</a> 扩展内置数据表</h3><p>对于 <code>user</code> 或 <code>channel</code> 等内置数据表，以及来自其他插件的表，比起重新定义整个表模型，更常见的场景是需要在表内添加若干字段。这种情况下 <code>@MixinModel</code> 可能为适合。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">declare</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">module</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi&#39;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">interface</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">User</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    dress</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Dress</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// 无需 @DefineModel 装饰器</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Dress</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">ModelField</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;string(8)&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">ModelField</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;integer(7)&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  size</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">getDisplayString</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> dress of size </span><span style="color:#F92672;">${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.id</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">MixinModel</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;user&#39;</span><span style="color:#F8F8F2;">, { dress: Dress }) </span><span style="color:#88846F;">// 将 Dress 类成员字段作为 dress 属性注入到 user 表中</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">StarterPlugin</span><span style="color:#F8F8F2;">(MyPluginConfig) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mydress&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">getDress</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutUser</span><span style="color:#F8F8F2;">([</span><span style="color:#E6DB74;">&#39;name&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">]) </span><span style="color:#FD971F;font-style:italic;">user</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">User</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">user.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> is wearing a </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">user.dress.</span><span style="color:#A6E22E;">getDisplayString</span><span style="color:#F8F8F2;">()</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">.`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/koishijs/koishijs.github.io/edit/docs/community/decorator/thirdeye.md" rel="noopener noreferrer" target="_blank" aria-label="帮助我们改善此页面"><!--[--><!--]--> 帮助我们改善此页面 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.d641dd0e.js" defer></script>
  </body>
</html>
